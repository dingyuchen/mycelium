<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><link rel="icon" href="/mycelium/favicon.ico"/><title>Nix Darwin</title><meta name="robots" content="index,follow"/><meta name="googlebot" content="index,follow"/><meta name="description" content="Ding&#x27;s Digital Garden"/><meta property="og:title" content="Nix Darwin"/><meta property="og:description" content="Ding&#x27;s Digital Garden"/><meta property="og:url" content="https://dingyuchen.github.io//mycelium/notes/6kkz0xmm5hm3yr3oqhyy4k6/"/><meta property="og:type" content="article"/><meta property="article:published_time" content="10/22/2022"/><meta property="article:modified_time" content="11/3/2022"/><link rel="canonical" href="https://dingyuchen.github.io//mycelium/notes/6kkz0xmm5hm3yr3oqhyy4k6/"/><meta name="next-head-count" content="14"/><link rel="preload" href="/mycelium/_next/static/css/0ba20f6b0c86b8f5.css" as="style"/><link rel="stylesheet" href="/mycelium/_next/static/css/0ba20f6b0c86b8f5.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/mycelium/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/mycelium/_next/static/chunks/webpack-c8a9dd4df44006a8.js" defer=""></script><script src="/mycelium/_next/static/chunks/framework-28c999baf2863c3d.js" defer=""></script><script src="/mycelium/_next/static/chunks/main-c1ff2486e08908e0.js" defer=""></script><script src="/mycelium/_next/static/chunks/pages/_app-4e712f343dfa3366.js" defer=""></script><script src="/mycelium/_next/static/chunks/935-4dee79e80b8641c6.js" defer=""></script><script src="/mycelium/_next/static/chunks/6-50972def09142ee2.js" defer=""></script><script src="/mycelium/_next/static/chunks/pages/notes/%5Bid%5D-78d472fa3b924116.js" defer=""></script><script src="/mycelium/_next/static/Ik9kw2fFq84c59EySbwfx/_buildManifest.js" defer=""></script><script src="/mycelium/_next/static/Ik9kw2fFq84c59EySbwfx/_ssgManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><section class="ant-layout" style="width:100%;min-height:100%"><header class="ant-layout-header" style="position:fixed;isolation:isolate;z-index:1;width:100%;border-bottom:1px solid #d4dadf;height:64px;padding:0 24px 0 2px"><div class="ant-row ant-row-center" style="max-width:992px;justify-content:space-between;margin:0 auto"><div style="display:flex" class="ant-col ant-col-xs-20 ant-col-sm-4"></div><div class="ant-col gutter-row ant-col-xs-0 ant-col-sm-20 ant-col-md-20 ant-col-lg-19"><div class="ant-select ant-select-lg ant-select-auto-complete ant-select-single ant-select-allow-clear ant-select-show-search" style="width:100%"><div class="ant-select-selector"><span class="ant-select-selection-search"><input type="search" autoComplete="off" class="ant-select-selection-search-input" role="combobox" aria-haspopup="listbox" aria-owns="undefined_list" aria-autocomplete="list" aria-controls="undefined_list" aria-activedescendant="undefined_list_0" value=""/></span><span class="ant-select-selection-placeholder">For full text search please use the &#x27;?&#x27; prefix. e.g. ? Onboarding</span></div></div></div><div style="display:none;align-items:center;justify-content:center" class="ant-col ant-col-xs-4 ant-col-sm-4 ant-col-md-0 ant-col-lg-0"><span role="img" aria-label="menu" style="font-size:24px" tabindex="-1" class="anticon anticon-menu"><svg viewBox="64 64 896 896" focusable="false" data-icon="menu" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M904 160H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0 624H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0-312H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8z"></path></svg></span></div></div></header><section class="ant-layout" style="margin-top:64px;display:flex;flex-direction:row"><div class="site-layout-sidebar" style="flex:0 0 auto;width:calc(max((100% - 992px) / 2, 0px) + 200px);min-width:200px;padding-left:calc((100% - 992px) / 2)"><aside class="ant-layout-sider ant-layout-sider-dark" style="position:fixed;overflow:auto;height:calc(100vh - 64px);background-color:transparent;flex:0 0 200px;max-width:200px;min-width:200px;width:200px"><div class="ant-layout-sider-children"></div></aside></div><main class="ant-layout-content side-layout-main" style="max-width:1200px;min-width:0;display:block"><div style="padding:0 24px"><div class="main-content" role="main"><div class="ant-row"><div class="ant-col ant-col-24"><div class="ant-row" style="margin-left:-10px;margin-right:-10px"><div style="padding-left:10px;padding-right:10px" class="ant-col ant-col-xs-24 ant-col-md-18"><div><h1 id="nix-darwin">Nix Darwin<a aria-hidden="true" class="anchor-heading icon-link" href="#nix-darwin"></a></h1>
<h2 id="why">Why<a aria-hidden="true" class="anchor-heading icon-link" href="#why"></a></h2>
<p>Nix darwin brings the configuration.nix part of NixOS to macOS.
I think its a good starting point to find out more about the nix ecosystem and framework.</p>
<p>The main usecase for vanilla nix would be to create hermetic development environments, but that is not immediately necessary in the case of the work laptop, since most of the versioning and environment management is already handled by <code>spkit</code> and <code>make</code>.</p>
<p>Furthermore, it makes more sense to use <code>nix-darwin</code> to replace the base environment before setting up repo-specific <code>nix-shell</code>s to maintain the developer experience.</p>
<h2 id="setting-up">Setting Up<a aria-hidden="true" class="anchor-heading icon-link" href="#setting-up"></a></h2>
<pre><code>darwin-rebuild switch -I darwin-config=dotfiles/darwin-configuration.nix
</code></pre>
<p>This sources the custom configuration. <code>ds</code> can be used as per normal after.</p>
<h2 id="appendix">Appendix<a aria-hidden="true" class="anchor-heading icon-link" href="#appendix"></a></h2>
<h3 id="gui-apps">GUI Apps<a aria-hidden="true" class="anchor-heading icon-link" href="#gui-apps"></a></h3>
<blockquote>
<p>Currently only system-level GUI apps are only linked into <code>~/Applications</code></p>
<p>Refer to <a href="https://github.com/LnL7/nix-darwin/issues/276">https://github.com/LnL7/nix-darwin/issues/276</a></p>
</blockquote>
<h3 id="fhs">FHS<a aria-hidden="true" class="anchor-heading icon-link" href="#fhs"></a></h3>
<p><a href="https://en.wikipedia.org/wiki/Filesystem_Hierarchy_Standard">FHS</a> versions of <code>vscode</code> and <code>vscodium</code> are not supported on macOS.
There is also no need to use the FHS versions, since GUI apps are better managed as <code>brew casks</code> at this point in time anyway.</p>
<h2 id="patchelf">PatchELF<a aria-hidden="true" class="anchor-heading icon-link" href="#patchelf"></a></h2>
<hr>
<strong>Children</strong>
<ol>
<li><a href="/mycelium/notes/aeyep204nrqd1svsek50ilw">Fish</a></li>
</ol></div></div><div style="padding-left:10px;padding-right:10px" class="ant-col ant-col-xs-0 ant-col-md-6"><div><div class=""><div class="ant-anchor-wrapper dendron-toc" style="max-height:calc(100vh - 64px);z-index:1"><div class="ant-anchor"><div class="ant-anchor-ink"><span class="ant-anchor-ink-ball"></span></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#why" title="Why">Why</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#setting-up" title="Setting Up">Setting Up</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#appendix" title="Appendix">Appendix</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#gui-apps" title="GUI Apps">GUI Apps</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#fhs" title="FHS">FHS</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#patchelf" title="PatchELF">PatchELF</a></div></div></div></div></div></div></div></div></div></div></div><div class="ant-divider ant-divider-horizontal" role="separator"></div><footer class="ant-layout-footer" style="padding:0 24px 24px"></footer></main></section></section></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"note":{"id":"6kkz0xmm5hm3yr3oqhyy4k6","title":"Nix Darwin","desc":"","updated":1667459159994,"created":1666425579784,"custom":{},"fname":"tooling.nix.darwin","type":"note","vault":{"fsPath":".","selfContained":true,"name":"mycelium","remote":{"type":"git","url":"git@github.com:dingyuchen/mycelium.git"}},"contentHash":"3e652da31192f00513339a446f109d13","links":[],"anchors":{"why":{"type":"header","text":"Why","value":"why","line":8,"column":0,"depth":2},"setting-up":{"type":"header","text":"Setting Up","value":"setting-up","line":17,"column":0,"depth":2},"appendix":{"type":"header","text":"Appendix","value":"appendix","line":25,"column":0,"depth":2},"gui-apps":{"type":"header","text":"GUI Apps","value":"gui-apps","line":27,"column":0,"depth":3},"fhs":{"type":"header","text":"FHS","value":"fhs","line":33,"column":0,"depth":3},"patchelf":{"type":"header","text":"PatchELF","value":"patchelf","line":38,"column":0,"depth":2}},"children":["aeyep204nrqd1svsek50ilw"],"parent":"smasnp7xn4wspgqjvfd5ihb","data":{}},"body":"\u003ch1 id=\"nix-darwin\"\u003eNix Darwin\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#nix-darwin\"\u003e\u003c/a\u003e\u003c/h1\u003e\n\u003ch2 id=\"why\"\u003eWhy\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#why\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eNix darwin brings the configuration.nix part of NixOS to macOS.\nI think its a good starting point to find out more about the nix ecosystem and framework.\u003c/p\u003e\n\u003cp\u003eThe main usecase for vanilla nix would be to create hermetic development environments, but that is not immediately necessary in the case of the work laptop, since most of the versioning and environment management is already handled by \u003ccode\u003espkit\u003c/code\u003e and \u003ccode\u003emake\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eFurthermore, it makes more sense to use \u003ccode\u003enix-darwin\u003c/code\u003e to replace the base environment before setting up repo-specific \u003ccode\u003enix-shell\u003c/code\u003es to maintain the developer experience.\u003c/p\u003e\n\u003ch2 id=\"setting-up\"\u003eSetting Up\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#setting-up\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cpre\u003e\u003ccode\u003edarwin-rebuild switch -I darwin-config=dotfiles/darwin-configuration.nix\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis sources the custom configuration. \u003ccode\u003eds\u003c/code\u003e can be used as per normal after.\u003c/p\u003e\n\u003ch2 id=\"appendix\"\u003eAppendix\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#appendix\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003ch3 id=\"gui-apps\"\u003eGUI Apps\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#gui-apps\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cblockquote\u003e\n\u003cp\u003eCurrently only system-level GUI apps are only linked into \u003ccode\u003e~/Applications\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003eRefer to \u003ca href=\"https://github.com/LnL7/nix-darwin/issues/276\"\u003ehttps://github.com/LnL7/nix-darwin/issues/276\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch3 id=\"fhs\"\u003eFHS\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#fhs\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003e\u003ca href=\"https://en.wikipedia.org/wiki/Filesystem_Hierarchy_Standard\"\u003eFHS\u003c/a\u003e versions of \u003ccode\u003evscode\u003c/code\u003e and \u003ccode\u003evscodium\u003c/code\u003e are not supported on macOS.\nThere is also no need to use the FHS versions, since GUI apps are better managed as \u003ccode\u003ebrew casks\u003c/code\u003e at this point in time anyway.\u003c/p\u003e\n\u003ch2 id=\"patchelf\"\u003ePatchELF\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#patchelf\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003chr\u003e\n\u003cstrong\u003eChildren\u003c/strong\u003e\n\u003col\u003e\n\u003cli\u003e\u003ca href=\"/mycelium/notes/aeyep204nrqd1svsek50ilw\"\u003eFish\u003c/a\u003e\u003c/li\u003e\n\u003c/ol\u003e","noteIndex":{"fname":"self","stub":true,"vault":{"fsPath":".","selfContained":true,"name":"mycelium","remote":{"type":"git","url":"git@github.com:dingyuchen/mycelium.git"}},"schemaStub":false,"type":"note","updated":1670335116867,"created":1670335116867,"id":"jeno2gw2ru0lk2hjk1t6kfu","desc":"","links":[],"anchors":{},"children":["70y9r1m7w3dczky3qheeu6x","z2mx05a21tjcul6e2zpymg8","7v6qrwbbehg9qifk52eo107"],"parent":null,"body":"","data":{},"title":"Self","custom":{"nav_order":0,"permalink":"/"}},"collectionChildren":null,"customHeadContent":null,"config":{"version":5,"dev":{"enablePreviewV2":true,"enableSelfContainedVaults":true},"commands":{"lookup":{"note":{"selectionMode":"extract","confirmVaultOnCreate":true,"vaultSelectionModeOnCreate":"smart","leaveTrace":false,"bubbleUpCreateNew":true,"fuzzThreshold":0.2}},"randomNote":{},"insertNoteLink":{"aliasMode":"none","enableMultiSelect":false},"insertNoteIndex":{"enableMarker":false},"copyNoteLink":{"aliasMode":"title"},"templateHierarchy":"template"},"workspace":{"vaults":[{"fsPath":"dependencies/localhost/workplace","selfContained":true,"name":"workplace"},{"fsPath":".","selfContained":true,"name":"mycelium","remote":{"type":"git","url":"git@github.com:dingyuchen/mycelium.git"}}],"journal":{"dailyDomain":"daily","name":"journal","dateFormat":"y.MM.dd","addBehavior":"childOfDomain"},"scratch":{"name":"scratch","dateFormat":"y.MM.dd.HHmmss","addBehavior":"asOwnDomain"},"task":{"name":"task","dateFormat":"y.MM.dd","addBehavior":"childOfCurrent","statusSymbols":{"":" ","wip":"w","done":"x","assigned":"a","moved":"m","blocked":"b","delegated":"l","dropped":"d","pending":"y"},"taskCompleteStatus":["done","x"],"prioritySymbols":{"H":"high","M":"medium","L":"low"},"todoIntegration":true,"createTaskSelectionType":"selection2link"},"graph":{"zoomSpeed":1,"createStub":false},"enableAutoCreateOnDefinition":false,"enableXVaultWikiLink":false,"enableRemoteVaultInit":true,"enableUserTags":true,"enableHashTags":true,"workspaceVaultSyncMode":"noCommit","enableAutoFoldFrontmatter":false,"enableEditorDecorations":true,"maxPreviewsCached":10,"maxNoteLength":204800,"enableFullHierarchyNoteTitle":false},"preview":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enableFrontmatterTags":true,"enableHashesForFMTags":false,"enablePrettyRefs":true,"enableKatex":true,"automaticallyShowPreview":false},"publishing":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enablePrettyRefs":true,"enableKatex":true,"copyAssets":true,"siteHierarchies":["self","programs","tooling"],"writeStubs":false,"siteRootDir":"docs","assetsPrefix":"/mycelium","siteUrl":"https://dingyuchen.github.io/","seo":{"title":"Mycelium","description":"Ding's Digital Garden"},"github":{"enableEditLink":true,"editLinkText":"Edit this page on GitHub","editBranch":"main","editViewMode":"tree"},"enableSiteLastModified":true,"enableFrontmatterTags":true,"enableHashesForFMTags":false,"enableRandomlyColoredTags":true,"enableTaskNotes":true,"enablePrettyLinks":true,"duplicateNoteBehavior":{"action":"useVault","payload":["workplace","mycelium"]},"searchMode":"lookup","siteFaviconPath":"favicon.ico","siteIndex":"self"}}},"__N_SSG":true},"page":"/notes/[id]","query":{"id":"6kkz0xmm5hm3yr3oqhyy4k6"},"buildId":"Ik9kw2fFq84c59EySbwfx","assetPrefix":"/mycelium","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>